@echo off
setlocal enabledelayedexpansion

rem -------------------------------------------------
rem Mapeie PATRONEX=BASEX aqui (uma linha por par)
rem Não será adicionado contador ao nome base; se houver conflito
rem o script adicionará sufixo _1, _2, ... para evitar sobrescrita
rem -------------------------------------------------

set "MAP1=VIP_*ANL_FO_DISPONIBILIDADE_FTTH_HC*=ANL FO DISPONIBILIDADE FTTH HC"
set "MAP2=VIP_*ANL_FO_DISPONIBILIDADE_FTTH*=ANL FO DISPONIBILIDADE FTTH"
set "MAP3=VIP_*ANL_FO_PLANTA*=ANL FO PLANTA"
set "MAP4=VIP_*ANL_FO_REPARO_NO_PRAZO_ACESSO_BACKBONE*=ANL FO REPARO NO PRAZO ACESSO BACKBONE"
set "MAP5=VIP_*ANL_FO_REPARO_NO_PRAZO_MASSIVAS_FTTH*=ANL FO REPARO NO PRAZO MASSIVAS FTTH"
set "MAP6=VIP_*ANL_FO_REPARO_NO_PRAZO*=ANL FO REPARO NO PRAZO"
set "MAP7=VIP_*ANL_FO_REPARO_POR_PLANTA*=ANL FO REPARO POR PLANTA"
set "MAP8=VIP_*ANL_FO_REPETIDA_30_DIAS*=ANL FO REPETIDA 3 DIAS"
set "MAP9=VIP_*ANL_FO_ROMPIMENTO_POR_1000_KM*=ANL FO ROMPIMENTO POR 1000 KM"

rem Adicione mais MAPn se necessário
set "MAX_MAPS=20"

rem Trabalha no diretório do script
cd /d "%~dp0"

set /a TOTAL_RENAMED=0

for /l %%I in (1,1,%MAX_MAPS%) do (
  call set "PAIR=%%MAP%%I%%"
  if defined PAIR (
    rem separa PATRON e BASE pelo caractere =
    for /f "tokens=1* delims==" %%A in ("!PAIR!") do (
      set "PATRON=%%~A"
      set "BASE=%%~B"
    )
    if defined PATRON if defined BASE (
      echo.
      echo Processando padrao: "!PATRON!"  ->  base: "!BASE!"
      rem lista arquivos que batem no padrão (somente arquivos)
      for /f "delims=" %%F in ('dir /b /a:-d "!PATRON!" 2^>nul') do (
        set "orig=%%F"
        rem pega extensao
        for %%X in ("%%~xF") do set "ext=%%~X"
        rem monta nome final sem contador
        set "newname=!BASE!!ext!"
        rem se existir, procura sufixo _1, _2, ...
        if exist "!newname!" (
          set /a SUF=1
          :find_suf_%%I_%%~nF
          set "candidate=!BASE!_!SUF!!ext!"
          if exist "!candidate!" (
            set /a SUF+=1
            goto :find_suf_%%I_%%~nF
          )
          set "newname=!candidate!"
        )
        ren "!orig!" "!newname!"
        if not errorlevel 1 (
          echo Renomeado: "!orig!" -> "!newname!"
          set /a TOTAL_RENAMED+=1
        ) else (
          echo Erro ao renomear "!orig!"
        )
      )
    )
  )
)

if %TOTAL_RENAMED% EQU 0 (
  echo.
  echo Nenhum arquivo renomeado. Verifique os padroes MAPn ou a existencia de arquivos correspondentes.
) else (
  echo.
  echo Total de arquivos renomeados: %TOTAL_RENAMED%.
)

endlocal
pause
